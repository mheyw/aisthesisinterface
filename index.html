<html lang=”en”>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Aisthesis Interface</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="crossorigin="anonymous"></script>
    </head>
    <body>
        <div id="welcome">
            <tt>Aisthesis Interface</tt><br><br>
            <p>Aisthesis as an ontological difference between two orders of reality</p>
            <p>Interface as the technique of mediation</p><br>
            <p-s>This website collects location data, motion data and images to generate spatialised images for the purpose of an art project.</p-s><br><br>
            <p-s>Any images you take may be used within an art piece that will be made using the data collected.</p-s><br><br>
            <p-s>By using this site you agree to the use of any images or data collected.</p-s><br><br>
            <p-s> All information collected is anonymous, is only collected when an image is taken and will only be stored for the duration of the project.</p-s><br><br>
            <p-s>Once you press begin you will be asked for permission to use your camera, location and motion data.</p-s>
            <p><br><br><br></p>
            <button class="roundedButton" id="begin" style="bottom: 30px; width:100px; left: calc(50% - 50px);" onclick="begin()">Begin</button>
        </div>
        <!-- Camera -->
        <main id="camera">
            <!-- Camera sensor -->
            <canvas id="camera--sensor"></canvas>
            <!-- Camera view -->
            <video id="camera--view" muted autoplay playsinline ></video>
            <!-- Camera output -->
            <img src="//:0" alt="" id="camera--output" class="resetPos">
            <!-- Camera trigger -->
            <button id="camera--trigger">Take a picture</button>
            <button class="roundedButton" id="camera--access" style="bottom:500px;">Allow Camera Access</button>
            <button class="roundedButton" id="location--access" style="bottom:400px;">Allow Location Access</button>
            <button class="roundedButton" id="motion--access" style="bottom:300px;">Allow Motion Access</button>
            <div class="loading">
            <div class="lds-roller" id="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>
            <p id="status"></p>
            <script>
                function begin(){
                    document.getElementById("welcome").style.display = "none";
                }
                
                let IO_obj = {
                    camImg: '',
                    gpsLat: null,
                    gpsLong: null,
                    moAlpha: null,
                    moGamma: null,
                    moBeta: null,
                    imgProgress: false
                };

                document.getElementById("camera--trigger").style.display = "none";

                function loop(timestamp) {
                    //if geolocation available remove button
                    if(IO_obj.gpsLat !== null && IO_obj.gpsLat !== undefined){
                        document.getElementById("location--access").style.display = "none";
                    };
                    //if motion data available remove button
                    if(IO_obj.moAlpha !== null && IO_obj.moAlpha !== undefined){
                        document.getElementById("motion--access").style.display = "none";
                    };
                    if(IO_obj.imgProgress == true){
                        document.getElementById("lds-roller").style.display = "inline-block";
                    }
                    //if everything is available allow image capture
                    if(IO_obj.gpsLat !== null && IO_obj.gpsLat !== undefined && IO_obj.moAlpha !== null && IO_obj.moAlpha !== undefined){
                        //check if img is being uploaded
                        if(IO_obj.imgProgress == false){
                            document.getElementById("camera--trigger").style.display = "block";
                            document.getElementById("lds-roller").style.display = "none";
                        }
                        document.getElementById("status").style.display = "block";
                        const status = document.querySelector('#status');
                        status.textContent = IO_obj.gpsLat.toFixed(2) + '\r\n' +  IO_obj.gpsLong.toFixed(2) + '\r\n' + 
                            IO_obj.moAlpha.toFixed(0) + '\r\n' + 
                            IO_obj.moBeta.toFixed(0) + '\r\n' + 
                            IO_obj.moGamma.toFixed(0);
                    }

                    lastRender = timestamp;
                    window.requestAnimationFrame(loop);
                }
                let lastRender = 0;
                window.requestAnimationFrame(loop);
            </script>
        </main>
        <script src="webCamScript.js"></script>
        <script src="gpsScript.js"></script>
        <script src="motionScript.js"></script>
    </body>
</html>